/* ===========================
   Pest.css  — Polished Edition
   =========================== */

/* ----- Color System & Easing ----- */
:root {
  --bg-grad-1: #f7faf7;
  --bg-grad-2: #eef7f1;
  --bg-grad-3: #ffffff;

  --ink-900: #0f172a;
  --ink-700: #1f2937;
  --ink-600: #334155;
  --ink-500: #475569;

  --brand: #10b981;      /* primary green */
  --brand-600: #0ea371;
  --brand-50: #e7fbf3;

  --sky: #0ea5e9;        /* send blue */
  --sky-600: #0685bd;

  --card: #ffffff;
  --card-border: #e6eef0;

  --muted: #5b6b7a;
  --muted-2: #94a3b8;

  --success-bg: #eefcf6;
  --success-bd: #d7efe6;

  --info-bg: #e7f2ff;
  --info-bd: #cfe3ff;

  --elev-1: 0 1px 2px rgba(2,6,23,.05), 0 6px 20px rgba(2,6,23,.06);
  --elev-2: 0 10px 30px rgba(2,6,23,.08);
  --ring: 0 0 0 3px rgba(16,185,129,.18);

  --radius-lg: 16px;
  --radius-md: 12px;

  --ease: cubic-bezier(.22,.61,.36,1);
}

/* ===== Base Page ===== */
.pest-page {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(180deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 40%, var(--bg-grad-3) 100%);
  color: var(--ink-900);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Subtle page float-in */
.pest-page { animation: pageIn .5s var(--ease); }
@keyframes pageIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }

/* ===== Layout (4:6 split) ===== */
.pest-container {
  width: 100%;
  max-width: 1280px;
  margin: 0 auto;
  padding: 28px 24px 56px;
  display: grid;
  grid-template-columns: 4fr 6fr;
  column-gap: 28px;
  row-gap: 16px;
}

/* Left / Right columns */
.left-panel { grid-column: 1 / 2; display: flex; flex-direction: column; gap: 14px; }
.right-panel, .chat-panel { grid-column: 2 / 3; }

.pest-title { margin: 0 0 8px; font-size: 24px; font-weight: 800; letter-spacing: -0.015em; color: #0b3d2f; }

/* ===== Upload Card ===== */
.upload-area {
  background: color-mix(in oklab, #fff 88%, #f8fbf9);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-lg);
  padding: 18px;
  min-height: 320px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: var(--elev-1);
  transition: border-color .2s var(--ease), box-shadow .25s var(--ease), transform .06s var(--ease);
  backdrop-filter: saturate(1.05);
}
.upload-area:hover { border-color: #cfe6d9; box-shadow: var(--elev-2); transform: translateY(-1px); }

.upload-cta {
  cursor: pointer;
  background: #f8fbf9;
  border: 1px dashed #cfe6d9;
  color: var(--ink-900);
  border-radius: var(--radius-md);
  padding: 22px 24px;
  display: inline-flex; flex-direction: column; align-items: center; gap: 10px;
  transition: background .15s var(--ease), border-color .15s var(--ease), transform .06s var(--ease);
}
.upload-cta:hover { background: #f3faf5; border-color: #a8d7c4; transform: translateY(-1px); }

.upload-icon { font-size: 30px; filter: drop-shadow(0 4px 10px rgba(16,185,129,.25)); }
.upload-hint { font-size: 12px; color: var(--muted); }

.preview { width: 100%; max-width: 560px; margin: 0 auto; }
.preview img {
  width: 100%; max-height: 420px; object-fit: contain; background: #fff;
  border: 1px solid var(--card-border);
  border-radius: 14px;
  box-shadow: var(--elev-1);
}
.preview-name { margin: 10px 0 0; font-size: 13px; color: var(--ink-500); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.preview-actions { margin-top: 12px; display: flex; gap: 8px; }

/* ===== Buttons ===== */
.btn {
  appearance: none;
  border: 1px solid #d7e2e6;
  background: #fff;
  color: var(--ink-900);
  border-radius: 12px;
  padding: 12px 16px;
  font-weight: 700;
  letter-spacing: -.01em;
  cursor: pointer;
  transition: transform .06s var(--ease), box-shadow .2s var(--ease), border-color .2s var(--ease), background .2s var(--ease), opacity .2s var(--ease);
}
.btn:hover { transform: translateY(-1px); box-shadow: var(--elev-1); border-color: #cbd8dd; }
.btn:active { transform: translateY(0); }
.btn:disabled { opacity: .65; cursor: not-allowed; }
.btn.primary { background: var(--brand); border-color: var(--brand); color: #fff; }
.btn.primary:hover { background: var(--brand-600); border-color: var(--brand-600); }
.btn.ghost { background: transparent; border-style: dashed; color: var(--ink-600); }
.btn.send  { background: var(--sky); border-color: var(--sky); color: #fff; }
.btn.send:hover { background: var(--sky-600); border-color: var(--sky-600); }

/* ===== Alerts ===== */
.alert {
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid #fee2e2;
  background: #fff5f5;
  color: #9b1c1c;
}

/* ===== Chat Panel ===== */
.chat-panel {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius-lg);
  padding: 16px;
  box-shadow: var(--elev-1);
  display: flex; flex-direction: column;
  height: 620px; /* 고정 높이: 내용은 스크롤 */
  position: relative;
}

.chat-title {
  margin: 4px 4px 0;
  font-size: 16px;
  font-weight: 800;
  color: var(--ink-900);
  letter-spacing: -0.01em;
}

/* Scroll area */
.chat-scroll {
  flex: 1;
  overflow: auto;
  margin-top: 10px;
  padding: 14px 14px 18px;
  background: linear-gradient(180deg, #f8fafb 0%, #f7fbff 100%);
  border: 1px solid #edf2f6;
  border-radius: 12px;
  scroll-behavior: smooth;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
}

/* Pretty Scrollbar */
.chat-scroll::-webkit-scrollbar { width: 10px; height: 10px; }
.chat-scroll::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #d7e9f3, #cfe0e6);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.chat-scroll::-webkit-scrollbar-track { background: transparent; }

/* Bubbles */
.bubble { display: flex; margin: 12px 0; }
.bubble .bubble-inner { width: fit-content; max-width: min(780px, 80%); }

.bubble.assistant .bubble-inner,
.bubble.user .bubble-inner {
  padding: 12px 14px;
  border-radius: 14px;
  line-height: 1.6;
  font-size: 14.5px;
  box-shadow: 0 2px 10px rgba(2,6,23,.05);
  word-break: break-word;
  white-space: pre-wrap;
  transition: transform .06s var(--ease), box-shadow .2s var(--ease);
}

.bubble.assistant { align-self: flex-start; }
.bubble.assistant .bubble-inner {
  background: var(--success-bg);
  border: 1px solid var(--success-bd);
  color: #0b3d2f;
  border-top-left-radius: 6px;
}
.bubble.assistant .bubble-inner:hover { transform: translateY(-1px); box-shadow: var(--elev-1); }

.bubble.user { justify-content: flex-end; }
.bubble.user .bubble-inner {
  background: var(--info-bg);
  border: 1px solid var(--info-bd);
  color: #0a3a66;
  border-top-right-radius: 6px;
}
.bubble.user .bubble-inner:hover { transform: translateY(-1px); box-shadow: var(--elev-1); }

/* Typing indicator */
.bubble.typing .bubble-inner { position: relative; color: #0b3d2f; }
.bubble.typing .bubble-inner::after {
  content: "…";
  display: inline-block;
  animation: blink 1s steps(1,end) infinite;
  margin-left: 4px;
  opacity: .9;
}
@keyframes blink { 50% { opacity: 0; } }

/* ===== Markdown Typography (inside bubbles) ===== */
.bubble-inner h1,
.bubble-inner h2,
.bubble-inner h3,
.bubble-inner h4 {
  all: unset;
  display: block;
  font-weight: 800;
  letter-spacing: -0.01em;
  line-height: 1.3;
  color: #065f46;
  margin: 6px 0 6px;
}
.bubble-inner h1 { font-size: 19px; }
.bubble-inner h2 { font-size: 17px; }
.bubble-inner h3 { font-size: 16px; }
.bubble-inner h4 { font-size: 15px; }

.bubble-inner p { margin: 4px 0 8px; color: var(--ink-700); }
.bubble-inner strong { color: var(--ink-900); font-weight: 800; }
.bubble-inner em { font-style: italic; }

.bubble-inner ul,
.bubble-inner ol { margin: 6px 0 8px 18px; color: var(--ink-700); }
.bubble-inner li { margin: 4px 0; }

.bubble-inner a {
  color: #0b8fda;
  text-decoration: none;
  border-bottom: 1px dashed rgba(11,143,218,.4);
}
.bubble-inner a:hover { border-bottom-style: solid; }

.bubble-inner blockquote {
  margin: 8px 0;
  padding: 8px 12px;
  border-left: 3px solid #a7f3d0;
  background: #f0fdf4;
  border-radius: 6px;
  color: #065f46;
}

.bubble-inner code {
  background: #f3f4f6;
  border: 1px solid #e5e7eb;
  padding: 2px 6px;
  border-radius: 6px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 13px;
}

/* ===== Input Row (frosted bar) ===== */
.chat-input-row {
  display: flex; align-items: stretch; gap: 10px;
  margin-top: 12px;
  padding: 10px;
  border-radius: 14px;
  background: rgba(255,255,255,.7);
  box-shadow: 0 6px 24px rgba(2,6,23,.05);
  backdrop-filter: saturate(1.05) blur(2px);
}

.chat-input {
  flex: 1;
  border-radius: 12px;
  border: 1px solid #d7e2e6;
  padding: 12px 14px;
  min-height: 54px;
  resize: none;
  outline: none;
  font-family: inherit;
  transition: border-color .15s var(--ease), box-shadow .15s var(--ease), opacity .2s var(--ease);
}
.chat-input:focus { border-color: var(--brand); box-shadow: var(--ring); }

/* ===== Small Utilities ===== */
.actions { display: flex; gap: 10px; }

/* Skeleton (optional class .result.loading .skeleton ) */
.result.loading .skeleton {
  height: 14px; margin: 8px 0; border-radius: 10px;
  background: linear-gradient(90deg, #e9eef2 0%, #f4f8fb 50%, #e9eef2 100%);
  background-size: 300% 100%;
  animation: shimmer 1.2s infinite;
}
.result.loading .skeleton.title { height: 22px; }
@keyframes shimmer { 0% {background-position:0 0} 100% {background-position:100% 0} }

/* ===== Responsive ===== */
@media (max-width: 1080px) {
  .pest-container { grid-template-columns: 1fr; row-gap: 18px; }
  .chat-panel { height: 520px; }
  .preview img { max-height: 360px; }
}

@media (max-width: 640px) {
  .chat-panel { height: 480px; }
  .bubble .bubble-inner { max-width: 92%; }
  .pest-container { padding: 20px 16px 40px; }
}
